<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:fragment="head">
    <meta charset="UTF-8">
    <title>Daily Budget Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/css/style.css">
</head>

<body th:classappend="${currentUser != null && currentUser.theme == 'DARK' ? 'dark-mode' : ''}">

    <div th:fragment="sidebar" id="sidebar-wrapper">
        <div class="sidebar-heading">ðŸ’° Budget Tracker</div>
        <div class="list-group list-group-flush">
            <a th:href="@{/}" class="list-group-item list-group-item-action"
                th:classappend="${activePage == 'dashboard' ? 'active' : ''}">
                <i class="fas fa-tachometer-alt sidebar-icon"></i>Dashboard
            </a>
            <a th:href="@{/transactions}" class="list-group-item list-group-item-action"
                th:classappend="${activePage == 'transactions' ? 'active' : ''}">
                <i class="fas fa-list sidebar-icon"></i>Transactions
            </a>
            <a th:href="@{/budgets}" class="list-group-item list-group-item-action"
                th:classappend="${activePage == 'budgets' ? 'active' : ''}">
                <i class="fas fa-wallet sidebar-icon"></i>Budgets
            </a>
            <a th:href="@{/reports}" class="list-group-item list-group-item-action"
                th:classappend="${activePage == 'reports' ? 'active' : ''}">
                <i class="fas fa-chart-line sidebar-icon"></i>Reports
            </a>
            <a th:href="@{/settings}" class="list-group-item list-group-item-action"
                th:classappend="${activePage == 'settings' ? 'active' : ''}">
                <i class="fas fa-cog sidebar-icon"></i>Settings
            </a>
        </div>
    </div>

    <nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container-fluid">
            <button class="btn btn-primary" id="sidebarToggle"><i class="fas fa-bars"></i></button>

            <div class="dropdown" sec:authorize="isAuthenticated()">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <img th:if="${#authentication.principal.profilePicture != null}"
                        th:src="@{'/user-photos/' + ${#authentication.principal.id} + '/' + ${#authentication.principal.profilePicture}}"
                        class="rounded-circle me-2" height="30" width="30" style="object-fit: cover;" alt="User">
                    <i th:unless="${#authentication.principal.profilePicture != null}"
                        class="fas fa-user-circle fa-lg me-2"></i>
                    <span sec:authentication="principal.displayName">User</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" th:href="@{/profile}"><i class="fas fa-user me-2"></i>Profile</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <form th:action="@{/logout}" method="post" class="d-inline">
                            <button class="dropdown-item text-danger" type="submit"
                                style="width: 100%; text-align: left;"><i
                                    class="fas fa-sign-out-alt me-2"></i>Logout</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <footer th:fragment="footer" class="text-center py-3 mt-4 text-muted">
        <small>@Designed by Manjeet Singh @Copyright 2026</small>
    </footer>

    <div th:fragment="scripts">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="/js/script.js"></script>
        <!-- Theme & Currency Init -->
        <script th:inline="javascript">
            // Global Helper for Formatting
            window.getCurrencySymbol = function () {
                // Server-side injection or default
                /*[[${currentUser != null}]]*/
                let userCurr = /*[[${currentUser != null ? currentUser.currency : 'INR'}]]*/ 'INR';

                // Map codes to symbols
                const symbols = {
                    'USD': '$',
                    'EUR': 'â‚¬',
                    'INR': 'â‚¹',
                    'GBP': 'Â£'
                };
                return symbols[userCurr] || userCurr;
            };

            // Apply theme (fallback for immediate load if body class isn't enough or for dynamic changes? 
            // Actually body class is handled by Thymeleaf on load.
            // We might need to keep local storage sync if we want client-side only pages to work,
            // but we are moving to server-side.
        </script>
        <script>
            window.formatCurrency = function (val) {
                const symbol = window.getCurrencySymbol();
                return symbol + ' ' + parseFloat(val).toFixed(2);
            };

            document.addEventListener("DOMContentLoaded", function () {
                const symbol = getCurrencySymbol();

                // Update all static spans
                document.querySelectorAll('.currency-symbol').forEach(el => {
                    el.textContent = symbol;
                });

                // Update input placeholders if they have currency
                document.querySelectorAll('.currency-placeholder').forEach(el => {
                    el.placeholder = symbol + " 0.00";
                });
            });
        </script>
    </div>
</body>

</html>